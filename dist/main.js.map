{"version":3,"file":"main.js","sources":["../node_modules/watch/main.js"],"sourcesContent":["// Copyright 2010-2011 Mikeal Rogers\n//\n//    Licensed under the Apache License, Version 2.0 (the \"License\");\n//    you may not use this file except in compliance with the License.\n//    You may obtain a copy of the License at\n//\n//        http://www.apache.org/licenses/LICENSE-2.0\n//\n//    Unless required by applicable law or agreed to in writing, software\n//    distributed under the License is distributed on an \"AS IS\" BASIS,\n//    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n//    See the License for the specific language governing permissions and\n//    limitations under the License.\n\nvar sys = require('util')\n  , fs = require('fs')\n  , path = require('path')\n  , events = require('events')\n  ;\n\nfunction walk (dir, options, callback) {\n  if (!callback) {callback = options; options = {}}\n  if (!callback.files) callback.files = {};\n  if (!callback.pending) callback.pending = 0;\n  callback.pending += 1;\n  fs.stat(dir, function (err, stat) {\n    if (err) return callback(err);\n    callback.files[dir] = stat;\n    fs.readdir(dir, function (err, files) {\n      if (err) {\n        if(err.code === 'EACCES' && options.ignoreUnreadableDir) return callback();\n        return callback(err);\n      }\n      callback.pending -= 1;\n      files.forEach(function (f, index) {\n        f = path.join(dir, f);\n        callback.pending += 1;\n        fs.stat(f, function (err, stat) {\n          var enoent = false\n            , done = false;\n\n          if (err) {\n            if (err.code !== 'ENOENT' && (err.code !== 'EPERM' && options.ignoreNotPermitted)) {\n              return callback(err);\n            } else {\n              enoent = true;\n            }\n          }\n          callback.pending -= 1;\n          done = callback.pending === 0;\n          if (!enoent) {\n            if (options.ignoreDotFiles && path.basename(f)[0] === '.') return done && callback(null, callback.files);\n            if (options.filter && !options.filter(f, stat)) return done && callback(null, callback.files);\n            callback.files[f] = stat;\n            if (stat.isDirectory() && !(options.ignoreDirectoryPattern && options.ignoreDirectoryPattern.test(f))) walk(f, options, callback);\n            done = callback.pending === 0;\n            if (done) callback(null, callback.files);\n          }\n        })\n      })\n      if (callback.pending === 0) callback(null, callback.files);\n    })\n    if (callback.pending === 0) callback(null, callback.files);\n  })\n\n}\n\nvar watchedFiles = Object.create(null);\n\nexports.watchTree = function ( root, options, callback ) {\n  if (!callback) {callback = options; options = {}}\n  walk(root, options, function (err, files) {\n    if (err) throw err;\n    var fileWatcher = function (f) {\n      var fsOptions = {};\n      if (options.interval) {\n        fsOptions.interval = options.interval * 1000;\n      }\n      fs.watchFile(f, fsOptions, function (c, p) {\n        // Check if anything actually changed in stat\n        if (files[f] && !files[f].isDirectory() && c.nlink !== 0 && files[f].mtime.getTime() == c.mtime.getTime()) return;\n        files[f] = c;\n        if (!files[f].isDirectory()) callback(f, c, p);\n        else {\n          fs.readdir(f, function (err, nfiles) {\n            if (err) return;\n            nfiles.forEach(function (b) {\n              var file = path.join(f, b);\n              if (!files[file] && (options.ignoreDotFiles !== true || b[0] != '.')) {\n                fs.stat(file, function (err, stat) {\n                  if (options.filter && !options.filter(file, stat)) return;\n                  callback(file, stat, null);\n                  files[file] = stat;\n                  fileWatcher(file);\n                })\n              }\n            })\n          })\n        }\n        if (c.nlink === 0) {\n          // unwatch removed files.\n          delete files[f]\n          fs.unwatchFile(f);\n        }\n      })\n    }\n    fileWatcher(root);\n    for (var i in files) {\n      fileWatcher(i);\n    }\n    watchedFiles[root] = files;\n    callback(files, null, null);\n  })\n}\n\nexports.unwatchTree = function (root) {\n  if (!watchedFiles[root]) return;\n  Object.keys(watchedFiles[root]).forEach(fs.unwatchFile);\n  watchedFiles[root] = false;\n};\n\nexports.createMonitor = function (root, options, cb) {\n  if (!cb) {cb = options; options = {}}\n  var monitor = new events.EventEmitter();\n  monitor.stop = exports.unwatchTree.bind(null, root);\n\n  var prevFile = {file: null,action: null,stat: null};\n  exports.watchTree(root, options, function (f, curr, prev) {\n    // if not curr, prev, but f is an object\n    if (typeof f == \"object\" && prev == null && curr === null) {\n      monitor.files = f;\n      return cb(monitor);\n    }\n\n    // if not prev and either prevFile.file is not f or prevFile.action is not created\n    if (!prev) {\n      if (prevFile.file != f || prevFile.action != \"created\") {\n        prevFile = { file: f, action: \"created\", stat: curr };\n        return monitor.emit(\"created\", f, curr);\n      }\n    }\n\n    // if curr.nlink is 0 and either prevFile.file is not f or prevFile.action is not removed\n    if (curr) {\n      if (curr.nlink === 0) {\n        if (prevFile.file != f || prevFile.action != \"removed\") {\n          prevFile = { file: f, action: \"removed\", stat: curr };\n          return monitor.emit(\"removed\", f, curr);\n        }\n      }\n    }\n\n    // if prevFile.file is null or prevFile.stat.mtime is not the same as curr.mtime\n    if (prevFile.file === null) {\n      return monitor.emit(\"changed\", f, curr, prev);\n    }\n    // stat might return null, so catch errors\n    try {\n      if (prevFile.stat.mtime.getTime() !== curr.mtime.getTime()) {\n        return monitor.emit(\"changed\", f, curr, prev);\n      }\n    } catch(e) {\n      return monitor.emit(\"changed\", f, curr, prev);\n    }\n  })\n}\n\nexports.walk = walk;\n"],"names":[],"mappings":"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"}